name: Update Nodes Daily

on:
  schedule:
    - cron: '0 16 * * *'  # æ¯å¤© UTC 0 ç‚¹è‡ªåŠ¨è¿è¡Œ
  workflow_dispatch:      # æ”¯æŒæ‰‹åŠ¨è§¦å‘
  
# ğŸ”’ é˜²æ­¢å¹¶å‘è¿è¡Œï¼ˆéå¸¸å…³é”®ï¼‰
concurrency:
  group: update-nodes
  cancel-in-progress: true
  
jobs:
  update-nodes:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
          persist-credentials: false  # ç¦ç”¨é»˜è®¤å‡­æ®

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: pip install --upgrade pip

      - name: Run conversion script
        run: python convert.py

      - name: Commit and push changes
        env:
          MY_PAT: ${{ secrets.MY_PAT }}   # ä½¿ç”¨ Secrets
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add nodes.txt
          git commit -m "è‡ªåŠ¨æ›´æ–°èŠ‚ç‚¹å¤‡æ³¨ â°" 
          git pull --rebase origin main
          git push https://$MY_PAT@github.com/${{ github.repository }} HEAD:${GITHUB_REF##*/}
